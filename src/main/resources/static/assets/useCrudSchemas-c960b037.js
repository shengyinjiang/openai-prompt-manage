import{u as e,F as t}from"./useForm-a96365b0.js";import{d as a,L as o,r as n,s,O as l,o as i,c,g as r,w as d,a as u,z as m,h as p,y as h,Y as f,aC as g,aD as v,S as b,t as y,k as w,V as S,N as P,aE as x,aF as k,R as j,aG as F,aH as C}from"./index-fd4ebc93.js";import{E as D}from"./el-button-e210cb9e.js";import{b as O,e as L,t as N,f as R}from"./tree-0f59664d.js";import"./el-input-8087ab66.js";const _={key:0},z=a({__name:"Search",props:{schema:{type:Array,default:()=>[]},isCol:o.bool.def(!1),labelWidth:o.oneOfType([String,Number]).def("auto"),layout:o.string.validate((e=>["inline","bottom"].includes(e))).def("inline"),buttomPosition:o.string.validate((e=>["left","center","right"].includes(e))).def("center"),showSearch:o.bool.def(!0),showReset:o.bool.def(!0),expand:o.bool.def(!1),expandField:o.string.def(""),inline:o.bool.def(!0),model:{type:Object,default:()=>({})}},emits:["search","reset"],setup(a,{emit:o}){const S=a,{t:P}=w(),x=n(!0),k=s((()=>{let e=g(S.schema);if(S.expand&&S.expandField&&!u(x)){const t=v(e,(e=>e.field===S.expandField));if(t>-1){const a=e.length;e.splice(t+1,a)}}return"inline"===S.layout&&(e=e.concat([{field:"action",formItemProps:{labelWidth:"0px"}}])),e})),{register:j,elFormRef:F,methods:C}=e({model:S.model||{}}),O=async()=>{var e;await(null==(e=u(F))?void 0:e.validate((async e=>{if(e){const{getFormData:e}=C,t=await e();o("search",t)}})))},L=async()=>{var e;null==(e=u(F))||e.resetFields();const{getFormData:t}=C,a=await t();o("reset",a)},N=s((()=>({textAlign:S.buttomPosition}))),R=()=>{var e;null==(e=u(F))||e.resetFields(),x.value=!u(x)};return(e,o)=>{const n=l("Icon");return i(),c(f,null,[r(u(t),{"is-custom":!1,"label-width":a.labelWidth,"hide-required-asterisk":"",inline:a.inline,"is-col":a.isCol,schema:u(k),onRegister:u(j)},{action:d((()=>["inline"===a.layout?(i(),c("div",_,[a.showSearch?(i(),p(u(D),{key:0,type:"primary",onClick:O},{default:d((()=>[r(n,{icon:"ep:search",class:"mr-5px"}),b(" "+y(u(P)("common.query")),1)])),_:1})):h("",!0),a.showReset?(i(),p(u(D),{key:1,onClick:L},{default:d((()=>[r(n,{icon:"ep:refresh-right",class:"mr-5px"}),b(" "+y(u(P)("common.reset")),1)])),_:1})):h("",!0),a.expand?(i(),p(u(D),{key:2,text:"",onClick:R},{default:d((()=>[b(y(u(P)(x.value?"common.shrink":"common.expand"))+" ",1),r(n,{icon:x.value?"ant-design:up-outlined":"ant-design:down-outlined"},null,8,["icon"])])),_:1})):h("",!0)])):h("",!0)])),_:1},8,["label-width","inline","is-col","schema","onRegister"]),"bottom"===a.layout?(i(),c("div",{key:0,style:m(u(N))},[a.showSearch?(i(),p(u(D),{key:0,type:"primary",onClick:O},{default:d((()=>[r(n,{icon:"ep:search",class:"mr-5px"}),b(" "+y(u(P)("common.query")),1)])),_:1})):h("",!0),a.showReset?(i(),p(u(D),{key:1,onClick:L},{default:d((()=>[r(n,{icon:"ep:refresh-right",class:"mr-5px"}),b(" "+y(u(P)("common.reset")),1)])),_:1})):h("",!0),a.expand?(i(),p(u(D),{key:2,text:"",onClick:R},{default:d((()=>[b(y(u(P)(x.value?"common.shrink":"common.expand"))+" ",1),r(n,{icon:x.value?"ant-design:up-outlined":"ant-design:down-outlined"},null,8,["icon"])])),_:1})):h("",!0)],4)):h("",!0)],64)}}}),{t:A}=w(),I=e=>{const t=S({pageSize:10,currentPage:1,total:10,tableList:[],params:{...(null==e?void 0:e.defaultParams)||{}},loading:!0,currentRow:null}),a=s((()=>({...t.params,limit:t.pageSize,current:t.currentPage})));P((()=>t.currentPage),(()=>{r.getList()})),P((()=>t.pageSize),(()=>{1===t.currentPage||(t.currentPage=1),r.getList()}));const o=n(),l=n(),i=async()=>{await j();const e=u(o);return e},c=async a=>{if(await((null==e?void 0:e.delListApi)&&(null==e?void 0:e.delListApi(a)))){k.success(A("common.delSuccess"));const e=(t.total%t.pageSize===a.length||1===t.pageSize)&&t.currentPage>1?t.currentPage-1:t.currentPage;t.currentPage=e,r.getList()}},r={getList:async()=>{var o;t.loading=!0;const n=await(null==e?void 0:e.getListApi(u(a)).finally((()=>{t.loading=!1})));n&&(t.tableList=x(n||{},null==e?void 0:e.response.list),t.total=x(n||{},null==(o=null==e?void 0:e.response)?void 0:o.total)||0)},setProps:async(e={})=>{const t=await i();null==t||t.setProps(e)},setColumn:async e=>{const t=await i();null==t||t.setColumn(e)},getSelections:async()=>{const e=await i();return(null==e?void 0:e.selections)||[]},setSearchParams:e=>{t.currentPage=1,t.params=Object.assign(t.params,{pageSize:t.pageSize,pageIndex:t.currentPage,...e}),r.getList()},delList:async(e,a,o=!0)=>{const n=await i();if(a){if(!(null==n?void 0:n.selections.length))return void k.warning(A("common.delNoData"))}else if(!t.currentRow)return void k.warning(A("common.delNoData"));o?O.confirm(A("common.delMessage"),A("common.delWarning"),{confirmButtonText:A("common.delOk"),cancelButtonText:A("common.delCancel"),type:"warning"}).then((async()=>{await c(e)})):await c(e)}};return(null==e?void 0:e.props)&&r.setProps(e.props),{register:(e,t)=>{o.value=e,l.value=u(t)},elTableRef:l,tableObject:t,methods:r}},q=F("dict",{state:()=>({isSetDict:!1,dictObj:{}}),getters:{getDictObj(){return this.dictObj},getIsSetDict(){return this.isSetDict}},actions:{setDictObj(e){this.dictObj=e},setIsSetDict(e){this.isSetDict=e}}}),T=q(C),{t:W}=w(),E=e=>{const t=S({searchSchema:[],tableColumns:[],formSchema:[],detailSchema:[]}),a=B(e,t);t.searchSchema=a||[];const o=G(e);t.tableColumns=o||[];const n=H(e,t);t.formSchema=n;const s=M(e);return t.detailSchema=s,{allSchemas:t}},B=(e,t)=>{const a=[],o=[];L(e,(e=>{var n,s;if(null==(n=null==e?void 0:e.search)?void 0:n.show){const n={component:e.search.component||"Input",componentProps:{},...e.search,field:e.field,label:(null==(s=e.search)?void 0:s.label)||e.label};if(n.dictName){const e=T.getDictObj[n.dictName];n.componentProps.options=V(e)}else n.api&&o.push((async()=>{var e;const a=await n.api();if(a){const o=v(t.searchSchema,(e=>e.field===n.field));-1!==o&&(t.searchSchema[o].componentProps.options=V(a,null==(e=n.componentProps.optionsAlias)?void 0:e.labelField))}}));delete n.show,delete n.dictName,a.push(n)}}));for(const n of o)n();return a},G=e=>{const t=N(e,{conversion:e=>{var t;if(!1!==(null==(t=null==e?void 0:e.table)?void 0:t.show))return{...e.table,...e}}});return R(t,(e=>(void 0===e.children&&delete e.children,!!e.field)))},H=(e,t)=>{const a=[],o=[];L(e,(e=>{var n,s,l;if(!1!==(null==(n=null==e?void 0:e.form)?void 0:n.show)){const n={component:(null==(s=null==e?void 0:e.form)?void 0:s.component)||"Input",componentProps:{},...e.form,field:e.field,label:(null==(l=e.search)?void 0:l.label)||e.label};if(n.dictName){const e=T.getDictObj[n.dictName];n.componentProps.options=V(e)}else n.api&&o.push((async()=>{var e;const a=await n.api();if(a){const o=v(t.formSchema,(e=>e.field===n.field));-1!==o&&(t.formSchema[o].componentProps.options=V(a,null==(e=n.componentProps.optionsAlias)?void 0:e.labelField))}}));delete n.show,delete n.dictName,a.push(n)}}));for(const n of o)n();return a},M=e=>{const t=[];return L(e,(e=>{var a,o;if(!1!==(null==(a=null==e?void 0:e.detail)?void 0:a.show)){const a={...e.detail,field:e.field,label:(null==(o=e.detail)?void 0:o.label)||e.label};delete a.show,t.push(a)}})),t},V=(e,t)=>null==e?void 0:e.map((e=>(t?e.labelField=W(e.labelField):e.label=W(e.label),e)));export{z as _,E as a,q as b,I as u};
