import{u as e,F as t}from"./useForm-e296b64d.js";import{d as a,L as o,r as n,s as l,O as s,o as i,c as r,g as c,w as d,a as u,z as m,h as p,y as h,Y as f,aG as g,aH as v,S as b,t as y,k as w,V as P,N as S,aI as x,aJ as k,R as C,aK as F}from"./index-a4efef0e.js";import{E as L}from"./el-button-5e3ca3eb.js";import{b as j,e as N,t as R,f as _}from"./tree-cc87d18e.js";import"./el-input-763158f1.js";const z={key:0},O=a({__name:"Search",props:{schema:{type:Array,default:()=>[]},isCol:o.bool.def(!1),labelWidth:o.oneOfType([String,Number]).def("auto"),layout:o.string.validate((e=>["inline","bottom"].includes(e))).def("inline"),buttomPosition:o.string.validate((e=>["left","center","right"].includes(e))).def("center"),showSearch:o.bool.def(!0),showReset:o.bool.def(!0),expand:o.bool.def(!1),expandField:o.string.def(""),inline:o.bool.def(!0),model:{type:Object,default:()=>({})}},emits:["search","reset"],setup(a,{emit:o}){const P=a,{t:S}=w(),x=n(!0),k=l((()=>{let e=g(P.schema);if(P.expand&&P.expandField&&!u(x)){const t=v(e,(e=>e.field===P.expandField));if(t>-1){const a=e.length;e.splice(t+1,a)}}return"inline"===P.layout&&(e=e.concat([{field:"action",formItemProps:{labelWidth:"0px"}}])),e})),{register:C,elFormRef:F,methods:j}=e({model:P.model||{}}),N=async()=>{var e;await(null==(e=u(F))?void 0:e.validate((async e=>{if(e){const{getFormData:e}=j,t=await e();o("search",t)}})))},R=async()=>{var e;null==(e=u(F))||e.resetFields();const{getFormData:t}=j,a=await t();o("reset",a)},_=l((()=>({textAlign:P.buttomPosition}))),O=()=>{var e;null==(e=u(F))||e.resetFields(),x.value=!u(x)};return(e,o)=>{const n=s("Icon");return i(),r(f,null,[c(u(t),{"is-custom":!1,"label-width":a.labelWidth,"hide-required-asterisk":"",inline:a.inline,"is-col":a.isCol,schema:u(k),onRegister:u(C)},{action:d((()=>["inline"===a.layout?(i(),r("div",z,[a.showSearch?(i(),p(u(L),{key:0,type:"primary",onClick:N},{default:d((()=>[c(n,{icon:"ep:search",class:"mr-5px"}),b(" "+y(u(S)("common.query")),1)])),_:1})):h("",!0),a.showReset?(i(),p(u(L),{key:1,onClick:R},{default:d((()=>[c(n,{icon:"ep:refresh-right",class:"mr-5px"}),b(" "+y(u(S)("common.reset")),1)])),_:1})):h("",!0),a.expand?(i(),p(u(L),{key:2,text:"",onClick:O},{default:d((()=>[b(y(u(S)(x.value?"common.shrink":"common.expand"))+" ",1),c(n,{icon:x.value?"ant-design:up-outlined":"ant-design:down-outlined"},null,8,["icon"])])),_:1})):h("",!0)])):h("",!0)])),_:1},8,["label-width","inline","is-col","schema","onRegister"]),"bottom"===a.layout?(i(),r("div",{key:0,style:m(u(_))},[a.showSearch?(i(),p(u(L),{key:0,type:"primary",onClick:N},{default:d((()=>[c(n,{icon:"ep:search",class:"mr-5px"}),b(" "+y(u(S)("common.query")),1)])),_:1})):h("",!0),a.showReset?(i(),p(u(L),{key:1,onClick:R},{default:d((()=>[c(n,{icon:"ep:refresh-right",class:"mr-5px"}),b(" "+y(u(S)("common.reset")),1)])),_:1})):h("",!0),a.expand?(i(),p(u(L),{key:2,text:"",onClick:O},{default:d((()=>[b(y(u(S)(x.value?"common.shrink":"common.expand"))+" ",1),c(n,{icon:x.value?"ant-design:up-outlined":"ant-design:down-outlined"},null,8,["icon"])])),_:1})):h("",!0)],4)):h("",!0)],64)}}}),{t:A}=w(),D=e=>{const t=P({pageSize:10,currentPage:1,total:10,tableList:[],params:{...(null==e?void 0:e.defaultParams)||{}},loading:!0,currentRow:null}),a=l((()=>({...t.params,limit:t.pageSize,current:t.currentPage})));S((()=>t.currentPage),(()=>{c.getList()})),S((()=>t.pageSize),(()=>{1===t.currentPage||(t.currentPage=1),c.getList()}));const o=n(),s=n(),i=async()=>{await C();const e=u(o);return e},r=async a=>{if(await((null==e?void 0:e.delListApi)&&(null==e?void 0:e.delListApi(a)))){k.success(A("common.delSuccess"));const e=(t.total%t.pageSize===a.length||1===t.pageSize)&&t.currentPage>1?t.currentPage-1:t.currentPage;t.currentPage=e,c.getList()}},c={getList:async()=>{var o;t.loading=!0;const n=await(null==e?void 0:e.getListApi(u(a)).finally((()=>{t.loading=!1})));n&&(t.tableList=x(n||{},null==e?void 0:e.response.list),t.total=x(n||{},null==(o=null==e?void 0:e.response)?void 0:o.total)||0)},setProps:async(e={})=>{const t=await i();null==t||t.setProps(e)},setColumn:async e=>{const t=await i();null==t||t.setColumn(e)},getSelections:async()=>{const e=await i();return(null==e?void 0:e.selections)||[]},setSearchParams:e=>{t.currentPage=1,t.params=Object.assign(t.params,{pageSize:t.pageSize,pageIndex:t.currentPage,...e}),c.getList()},delList:async(e,a,o=!0)=>{const n=await i();if(a){if(!(null==n?void 0:n.selections.length))return void k.warning(A("common.delNoData"))}else if(!t.currentRow)return void k.warning(A("common.delNoData"));o?j.confirm(A("common.delMessage"),A("common.delWarning"),{confirmButtonText:A("common.delOk"),cancelButtonText:A("common.delCancel"),type:"warning"}).then((async()=>{await r(e)})):await r(e)}};return(null==e?void 0:e.props)&&c.setProps(e.props),{register:(e,t)=>{o.value=e,s.value=u(t)},elTableRef:s,tableObject:t,methods:c}},I=F(),{t:q}=w(),T=e=>{const t=P({searchSchema:[],tableColumns:[],formSchema:[],detailSchema:[]}),a=W(e,t);t.searchSchema=a||[];const o=B(e);t.tableColumns=o||[];const n=E(e,t);t.formSchema=n;const l=G(e);return t.detailSchema=l,{allSchemas:t}},W=(e,t)=>{const a=[],o=[];N(e,(e=>{var n,l;if(null==(n=null==e?void 0:e.search)?void 0:n.show){const n={component:e.search.component||"Input",componentProps:{},...e.search,field:e.field,label:(null==(l=e.search)?void 0:l.label)||e.label};if(n.dictName){const e=I.getDictObj[n.dictName];n.componentProps.options=H(e)}else n.api&&o.push((async()=>{var e;const a=await n.api();if(a){const o=v(t.searchSchema,(e=>e.field===n.field));-1!==o&&(t.searchSchema[o].componentProps.options=H(a,null==(e=n.componentProps.optionsAlias)?void 0:e.labelField))}}));delete n.show,delete n.dictName,a.push(n)}}));for(const n of o)n();return a},B=e=>{const t=R(e,{conversion:e=>{var t;if(!1!==(null==(t=null==e?void 0:e.table)?void 0:t.show))return{...e.table,...e}}});return _(t,(e=>(void 0===e.children&&delete e.children,!!e.field)))},E=(e,t)=>{const a=[],o=[];N(e,(e=>{var n,l,s;if(!1!==(null==(n=null==e?void 0:e.form)?void 0:n.show)){const n={component:(null==(l=null==e?void 0:e.form)?void 0:l.component)||"Input",componentProps:{},...e.form,field:e.field,label:(null==(s=e.search)?void 0:s.label)||e.label};if(n.dictName){const e=I.getDictObj[n.dictName];n.componentProps.options=H(e)}else n.api&&o.push((async()=>{var e;const a=await n.api();if(a){const o=v(t.formSchema,(e=>e.field===n.field));-1!==o&&(t.formSchema[o].componentProps.options=H(a,null==(e=n.componentProps.optionsAlias)?void 0:e.labelField))}}));delete n.show,delete n.dictName,a.push(n)}}));for(const n of o)n();return a},G=e=>{const t=[];return N(e,(e=>{var a,o;if(!1!==(null==(a=null==e?void 0:e.detail)?void 0:a.show)){const a={...e.detail,field:e.field,label:(null==(o=e.detail)?void 0:o.label)||e.label};delete a.show,t.push(a)}})),t},H=(e,t)=>null==e?void 0:e.map((e=>(t?e.labelField=q(e.labelField):e.label=q(e.label),e)));export{O as _,T as a,D as u};
